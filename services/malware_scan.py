import logging
import os
from typing import Optional


logger = logging.getLogger(__name__)


def _is_truthy(value: Optional[str]) -> bool:
    return str(value).lower() in {"1", "true", "yes", "on"}


def scan_bytes_for_malware(content: bytes) -> bool:
    required = _is_truthy(os.getenv("MALWARE_SCAN_REQUIRED", "1"))
    provider = (os.getenv("MALWARE_SCAN_PROVIDER") or "none").lower()

    if provider in {"none", "disabled", "off"}:
        if required:
            raise RuntimeError("Malware scanning is required but no provider is configured")
        return True

    message = f"Unsupported malware scanner provider: {provider}"
    if required:
        raise RuntimeError(message)
    logger.warning(message)
    return True
